{"version":3,"file":"ECharts.js","sources":["../../../src/client/components/ECharts.ts"],"sourcesContent":["import { LoadingIcon, decodeData } from '@vuepress/helper/client'\nimport { useDebounceFn, useEventListener } from '@vueuse/core'\nimport type { EChartsOption, EChartsType } from 'echarts'\nimport type * as ECharts from 'echarts'\nimport type { PropType, VNode } from 'vue'\nimport {\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n  watch,\n} from 'vue'\nimport { onContentUpdated } from 'vuepress/client'\n\nimport { useEChartsConfig } from '../helpers/index.js'\nimport '../styles/echarts.css'\n\ninterface EChartsConfig {\n  width?: number\n  height?: number\n  option: EChartsOption\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nconst AsyncFunction = (async (): Promise<void> => {}).constructor\n\nconst parseEChartsConfig = (\n  config: string,\n  type: 'js' | 'json',\n  echarts: typeof ECharts,\n  instance: EChartsType,\n): Promise<EChartsConfig> => {\n  if (type === 'js') {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-call\n    const runner = AsyncFunction(\n      'echarts',\n      'myChart',\n      `\\\nlet width,height,option,__echarts_config__;\n{\n${config}\n__echarts_config__={width,height,option};\n}\nreturn __echarts_config__;\n`,\n    )\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n    return runner(echarts, instance) as Promise<EChartsConfig>\n  }\n\n  return Promise.resolve({ option: JSON.parse(config) as EChartsOption })\n}\n\nexport default defineComponent({\n  name: 'ECharts',\n\n  props: {\n    /**\n     * ECharts config\n     *\n     * 图表配置\n     */\n    config: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Chart title\n     *\n     * 图表标题\n     */\n    title: String,\n\n    /**\n     * Chart config type\n     *\n     * 图表配置类型\n     */\n    type: {\n      type: String as PropType<'js' | 'json'>,\n      default: 'json',\n    },\n  },\n\n  setup(props) {\n    const echartsConfig = useEChartsConfig()\n    const echartsContainer = shallowRef<HTMLElement>()\n\n    const loaded = ref(false)\n\n    let instance: EChartsType | null = null\n\n    useEventListener(\n      'resize',\n      useDebounceFn(() => {\n        instance?.resize()\n      }, 100),\n    )\n\n    const destroyECharts = (): void => {\n      instance?.dispose()\n      instance = null\n    }\n\n    const renderECharts = async (): Promise<void> => {\n      if (__VUEPRESS_SSR__) return\n\n      const echarts = await import(/* webpackChunkName: \"echarts\" */ 'echarts')\n\n      if (!echartsConfig.isSetup) {\n        await echartsConfig.setup?.()\n        echartsConfig.isSetup = true\n      }\n\n      instance = echarts.init(echartsContainer.value)\n\n      const { option, ...size } = await parseEChartsConfig(\n        decodeData(props.config),\n        props.type,\n        echarts,\n        instance,\n      )\n\n      instance.resize(size)\n      instance.setOption({ ...echartsConfig.option, ...option })\n    }\n\n    onContentUpdated(async (reason) => {\n      if (reason === 'mounted') {\n        await renderECharts()\n        loaded.value = true\n      }\n    })\n\n    onMounted(() => {\n      if (!__VUEPRESS_DEV__) return\n\n      // config must be changed if type is changed, so no need to watch it\n      watch(\n        () => props.config,\n        async () => {\n          destroyECharts()\n          await nextTick()\n          await renderECharts()\n        },\n        { flush: 'post' },\n      )\n    })\n\n    onUnmounted(destroyECharts)\n\n    return (): (VNode | null)[] => [\n      props.title\n        ? h('div', { class: 'echarts-title' }, decodeURIComponent(props.title))\n        : null,\n      h('div', { class: 'echarts-wrapper' }, [\n        h('div', {\n          ref: echartsContainer,\n          class: 'echarts-container',\n        }),\n        loaded.value\n          ? null\n          : h(LoadingIcon, { class: 'echarts-loading', height: 360 }),\n      ]),\n    ]\n  },\n})\n"],"names":["AsyncFunction","parseEChartsConfig","config","type","echarts","instance","ECharts","defineComponent","props","echartsConfig","useEChartsConfig","echartsContainer","shallowRef","loaded","ref","useEventListener","useDebounceFn","destroyECharts","renderECharts","option","size","decodeData","onContentUpdated","reason","onMounted","watch","nextTick","onUnmounted","h","LoadingIcon"],"mappings":"oYA2BA,MAAMA,GAAiB,SAA2B,CAAC,GAAG,YAEhDC,EAAqB,CACzBC,EACAC,EACAC,EACAC,IAEIF,IAAS,KAEIH,EACb,UACA,UACA;AAAA;AAAA,EAGJE,CAAM;AAAA;AAAA;AAAA;AAAA,CAKJ,EAGcE,EAASC,CAAQ,EAG1B,QAAQ,QAAQ,CAAE,OAAQ,KAAK,MAAMH,CAAM,CAAmB,CAAC,EAGxE,IAAAI,EAAeC,EAAgB,CAC7B,KAAM,UAEN,MAAO,CAML,OAAQ,CACN,KAAM,OACN,SAAU,EACZ,EAOA,MAAO,OAOP,KAAM,CACJ,KAAM,OACN,QAAS,MACX,CACF,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAgBC,EAAAA,EAChBC,EAAmBC,IAEnBC,EAASC,EAAI,EAAK,EAExB,IAAIT,EAA+B,KAEnCU,EACE,SACAC,EAAc,IAAM,CAClBX,GAAU,OAAA,CACZ,EAAG,GAAG,CACR,EAEA,MAAMY,EAAiB,IAAY,CACjCZ,GAAU,UACVA,EAAW,IACb,EAEMa,EAAgB,SAA2B,CAC/C,GAAI,iBAAkB,OAEtB,MAAMd,EAAU,KAAM,QAAyC,SAAS,EAEnEK,EAAc,UACjB,MAAMA,EAAc,QAAA,EACpBA,EAAc,QAAU,IAG1BJ,EAAWD,EAAQ,KAAKO,EAAiB,KAAK,EAE9C,KAAM,CAAE,OAAAQ,EAAQ,GAAGC,CAAK,EAAI,MAAMnB,EAChCoB,EAAWb,EAAM,MAAM,EACvBA,EAAM,KACNJ,EACAC,CACF,EAEAA,EAAS,OAAOe,CAAI,EACpBf,EAAS,UAAU,CAAE,GAAGI,EAAc,OAAQ,GAAGU,CAAO,CAAC,CAC3D,EAEA,OAAAG,EAAiB,MAAOC,GAAW,CAC7BA,IAAW,YACb,MAAML,EAAAA,EACNL,EAAO,MAAQ,GAEnB,CAAC,EAEDW,EAAU,IAAM,CACT,kBAGLC,EACE,IAAMjB,EAAM,OACZ,SAAY,CACVS,IACA,MAAMS,EAAAA,EACN,MAAMR,EAAAA,CACR,EACA,CAAE,MAAO,MAAO,CAClB,CACF,CAAC,EAEDS,EAAYV,CAAc,EAEnB,IAAwB,CAC7BT,EAAM,MACFoB,EAAE,MAAO,CAAE,MAAO,eAAgB,EAAG,mBAAmBpB,EAAM,KAAK,CAAC,EACpE,KACJoB,EAAE,MAAO,CAAE,MAAO,iBAAkB,EAAG,CACrCA,EAAE,MAAO,CACP,IAAKjB,EACL,MAAO,mBACT,CAAC,EACDE,EAAO,MACH,KACAe,EAAEC,EAAa,CAAE,MAAO,kBAAmB,OAAQ,GAAI,CAAC,CAC9D,CAAC,CACH,CACF,CACF,CAAC"}