import{encodeData as p,Logger as U,ensureEndingSlash as P,isModuleAvailable as q,addViteSsrNoExternal as G,addViteOptimizeDepsExclude as y,addViteSsrExternal as C,addViteOptimizeDepsInclude as V,isArray as M}from"@vuepress/helper";import{colors as k,path as W,getDirname as z}from"vuepress/utils";import{container as E}from"@mdit/plugin-container";import{plantuml as X}from"@mdit/plugin-plantuml";const R=(e,r)=>{const{allowScripts:a,allowAll:n,allowList:t=new Set}=r??{};E(e,{name:"chartjs",openRender:(s,o,i,l)=>{const c=s[o].info.trimStart().slice(7).trim();let w="{}",h=!1,u=!1;const g=l?.filePathRelative??"";for(let m=o;m<s.length;m++){const{type:d,content:$,info:f}=s[m];if(d==="container_chartjs_close"){h&&!u&&(console.warn(`${k.magenta("chartjs")}: JavaScript in Chart.js block is found in ${k.cyan(g)}, ${k.red("it is ignored for security reasons")}.
To enable the chart, you must manually add it to allowlist, see https://vuepress.vuejs.org/plugin/markdown/markdown-charts/chartjs.html for details.
`),s[m].hidden=!0);break}$&&(d==="fence"&&(f==="json"?w=p($):(f==="js"||f==="javascript")&&(w=p($),h=!0,a&&(n||t.has(g))&&(u=!0))),s[m].type="chartjs_empty",s[m].hidden=!0)}return h&&!u?"":`<ChartJS config="${w}"${c?` title="${encodeURIComponent(c)}"`:""}${h?' type="js"':""}>`},closeRender:(s,o)=>s[o].hidden?"":"</ChartJS>"})},_=(e,r)=>{const{content:a,info:n}=e[r],t=n.trim().split(":",2)[1];return`<ECharts config="${p(a)}"${t?` title="${encodeURIComponent(t)}"`:""}></ECharts>`},x=(e,r)=>{const{allowScripts:a,allowAll:n,allowList:t=new Set}=r??{},{fence:s}=e.renderer.rules;e.renderer.rules.fence=(...o)=>{const[i,l]=o,{info:c}=i[l];return c.split(":",2)[0]==="echarts"?_(i,l):s(...o)},e.renderer.rules.echarts=_,E(e,{name:"echarts",openRender:(o,i,l,c)=>{const w=o[i].info.trimStart().slice(7).trim();let h="{}",u=!1,g=!1;const m=c?.filePathRelative??"";for(let d=i;d<o.length;d++){const{type:$,content:f,info:S}=o[d];if($==="container_echarts_close"){u&&!g&&(console.warn(`${k.magenta("[echarts]")}: JavaScript in echarts block is found in ${k.cyan(m)}, ${k.red("it is ignored for security reasons")}.
To enable the chart, you must manually add it to allowlist, see https://vuepress.vuejs.org/plugin/markdown/markdown-chart/echarts.html for details.
`),o[d].hidden=!0);break}f&&($==="fence"&&(S==="json"?h=f:(S==="js"||S==="javascript")&&(h=f,u=!0,a&&(n||t.has(m))&&(g=!0))),o[d].type="echarts_empty",o[d].hidden=!0)}return u&&!g?"":`<ECharts config="${p(h)}"${w?` title="${encodeURIComponent(w)}"`:""}${u?' type="js"':""}>`},closeRender:(o,i)=>o[i].hidden?"":"</ECharts>"})},B=["ant","pie","vue"],D=(e,r)=>{const a=e[r],{content:n,info:t}=a,s=t.trim().split(":",2)[1];return`<FlowChart code="${p(n)}" preset="${B.includes(s)?s:"vue"}"></FlowChart>`},A=e=>{const{fence:r}=e.renderer.rules;e.renderer.rules.fence=(...a)=>{const[n,t]=a,{info:s}=n[t],[o]=s.split(":",2);return o==="flow"||o==="flowchart"?D(n,t):r(...a)},e.renderer.rules.flowchart=D},I=(e,r)=>`<MarkMap content="${p(e[r].content)}"></MarkMap>`,L=e=>{const{fence:r}=e.renderer.rules;e.renderer.rules.fence=(...a)=>{const[n,t]=a,{info:s}=n[t],[o]=s.split(":",2);return o==="markmap"?I(n,t):r(...a)},e.renderer.rules.markmap=I},H=(e,r)=>`<Mermaid code="${p(e[r].content)}"></Mermaid>`,O=({diagram:e="mermaid",content:r,title:a="",indent:n=e!=="mermaid"})=>{const[,t,s]=/^\s*---\n([^]*?)\n---\n\n([\s\S]*)\s*$/m.exec(r)??[null,"",r],o=(!a||/^title:\s*(.*)/m.test(t)?t:`title: ${a}
${t}`).trim();return`${o?`---
${o}
---

`:""}${e==="mermaid"?"":`${e}
`}${n?s.split(`
`).map(i=>i?`  ${i}`:"").join(`
`):s}`},F=e=>`<Mermaid code="${p(O(e))}"${e.title?` title="${p(e.title)}"`:""}></Mermaid>`,b={class:["classDiagram"],c4c:["C4Context"],er:["erDiagram"],gantt:[""],"git-graph":["gitGraph"],journey:[""],mindmap:[""],kanban:[""],pie:[""],quadrant:["quadrantChart"],requirement:["requirementDiagram"],sequence:["sequenceDiagram"],state:["stateDiagram-v2"],timeline:[""],architecture:["architecture-beta"],block:["block-beta",!1],packet:["packet-beta",!1],sankey:["sankey-beta",!1],xy:["xychart-beta",!1],treemap:["treemap-beta",!1],radar:["radar-beta"]},T=e=>{const{fence:r}=e.renderer.rules;e.renderer.rules.fence=(...a)=>{const[n,t]=a,{content:s,info:o}=n[t],i=o.trim();if(i==="mermaid")return F({content:s,indent:!1});const[l,...c]=i.split(" ");return l in b?F({diagram:b[l][0]||l,title:c.join(" "),content:s,indent:b[l][1]??!0}):r(...a)},e.renderer.rules.mermaid=H},v=(e,r=["chronology","gantt","json","latex","math","mindmap","regex","salt","uml","wbs","yaml"].map(a=>({name:a})))=>{r.forEach(a=>{e.use(X,a)})},K=z(import.meta.url),J="@vuepress/plugin-markdown-chart",N=new U(J),j=P(W.resolve(K,"../client")),Q=(e,r=!0)=>{const a=q(e,import.meta);return r&&!a&&N.error(`Package ${e} is not installed, please install it manually!`),a},Y=async(e,r)=>{const a=new Set,n=new Set;return r.chartjs&&(a.add(`import ChartJS from "${j}components/ChartJS.js";`),n.add('app.component("ChartJS", ChartJS)')),r.echarts&&(a.add(`import ECharts from "${j}components/ECharts.js";`),n.add('app.component("ECharts", ECharts);')),r.flowchart&&(a.add(`import FlowChart from "${j}components/FlowChart.js";`),n.add('app.component("FlowChart", FlowChart);')),r.markmap&&(a.add(`import MarkMap from "${j}components/MarkMap.js";`),n.add('app.component("MarkMap", MarkMap);')),r.mermaid&&(a.add(`import Mermaid from "${j}components/Mermaid.js";`),n.add('app.component("Mermaid", Mermaid);')),e.writeTemp("markdown-chart/config.js",`import { defineClientConfig } from "vuepress/client";
${Array.from(a.values()).join(`
`)}

export default defineClientConfig({
  enhance: ({ app }) => {
${Array.from(n.values()).map(t=>t.split(`
`).map(s=>`    ${s}`)).flat().join(`
`)}
  },
});
`)},Z=(e={})=>r=>{r.env.isDebug&&N.info("Options:",e);const a=(t,s=[])=>{const o=!!e[t],i=s.every(l=>Q(l,!!e[t]));return o&&i},n={chartjs:a("chartjs",["chart.js"]),echarts:a("echarts",["echarts"]),flowchart:a("flowchart",["flowchart.ts"]),markmap:a("markmap",["markmap-lib","markmap-toolbar","markmap-view"]),mermaid:a("mermaid",["mermaid"])};return{name:J,extendsMarkdown:t=>{const{DANGEROUS_ALLOW_SCRIPT_EXECUTION:s,DANGEROUS_SCRIPT_EXECUTION_ALLOWLIST:o}=e,i={allowScripts:s??!1,allowAll:o==="*",allowList:new Set(M(o)?o.map(l=>{const c=l.replace(/\\/g,"/").replace(/^\//,"");return c.endsWith(".md")?c:`${c}.md`}):[])};n.chartjs&&t.use(R,i),n.echarts&&t.use(x,i),n.flowchart&&t.use(A),M(e.plantuml)?t.use(v,e.plantuml):e.plantuml&&t.use(v),n.markmap&&t.use(L),n.mermaid&&t.use(T)},extendsBundlerOptions:t=>{G(t,r,["@vuepress/helper","fflate"]),n.chartjs&&(y(t,r,"chart.js/auto/auto.mjs"),C(t,r,"chart.js")),n.echarts&&(y(t,r,"echarts"),C(t,r,"echarts")),n.flowchart&&(y(t,r,"flowchart.ts"),C(t,r,"flowchart.ts")),n.markmap&&(V(t,r,["markmap-lib","markmap-toolbar","markmap-view"]),C(t,r,["markmap-lib","markmap-toolbar","markmap-view"])),n.mermaid&&(y(t,r,"mermaid/dist/mermaid.esm.min.mjs"),C(t,r,"mermaid"))},clientConfigFile:()=>Y(r,n)}};export{R as chartjs,x as echarts,A as flowchart,O as getMermaidContent,Z as markdownChartPlugin,L as markmap,T as mermaid,v as plantuml};
//# sourceMappingURL=index.js.map
