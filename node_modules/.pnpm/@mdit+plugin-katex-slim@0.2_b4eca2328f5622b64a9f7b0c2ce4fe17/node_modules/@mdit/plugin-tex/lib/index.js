import{isSpace as e}from"markdown-it/lib/common/utils.mjs";const t=String.raw`\[`,n=String.raw`\(`,r=(e,t,n=0)=>{let r=0,i=t-1;for(;i>=n&&e.charCodeAt(i)===92;)r++,i--;return r},i=(t,n,r)=>{let i=t.src.charCodeAt(n-1),a=t.src.charCodeAt(n+1);return{canOpen:r||!e(a),canClose:!(a>=48&&a<=57)&&(r||!e(i))}},a=e=>(t,n)=>{if(t.src[t.pos]!==`$`)return!1;let r=i(t,t.pos,e);if(!r.canOpen)return n||(t.pending+=`$`),t.pos++,!0;let a=t.pos+1,o=a,s,c=t.src.lastIndexOf(`$`);if(c===-1)return!1;for(;(o=t.src.indexOf(`$`,o))<=c;){for(s=o-1;t.src.charCodeAt(s)===92;)s--;if((o-s)%2==1)break;o++}if(o===-1)return n||(t.pending+=`$`),t.pos=a,!0;if(o-a===0)return n||(t.pending+=`$$`),t.pos=a+1,!0;if(r=i(t,o,e),!r.canClose)return n||(t.pending+=`$`),t.pos=a,!0;if(!n){let e=t.push(`math_inline`,`math`,0);e.markup=`$`,e.content=t.src.slice(a,o)}return t.pos=o+1,!0},o=()=>(e,t)=>{let i=e.pos;if(e.src.charCodeAt(i)!==92||e.src.charCodeAt(i+1)!==40)return!1;let a=i+2,o=!1,s=e.src.length;for(;a<s-1;){if(e.src.charCodeAt(a)===92&&e.src.charCodeAt(a+1)===41){if(r(e.src,i)%2==1)return!1;if(r(e.src,a,i+2)%2==0){o=!0;break}}a++}if(!o)return!1;if(!t){let t=e.push(`math_inline`,`math`,0);t.markup=n,t.content=e.src.slice(i+2,a)}return e.pos=a+2,!0},s=(e,t,n,r)=>{let i=e.bMarks[t]+e.tShift[t],a=e.eMarks[t];if(i+2>a||e.src.charCodeAt(i)!==36||e.src.charCodeAt(i+1)!==36)return!1;if(r)return!0;let o=e.skipSpacesBack(a,i),s=i+2,c,l=!1;o-s>=2&&e.src.charCodeAt(o-1)===36&&e.src.charCodeAt(o-2)===36?(c=e.src.slice(s,o-2),l=!0):c=e.src.slice(s,a);let u=t,d=``;for(;!l&&(u++,!(u>=n||(s=e.bMarks[u]+e.tShift[u],a=e.eMarks[u],s<a&&e.tShift[u]<e.blkIndent)));)o=e.skipSpacesBack(a,s),o-s>=2&&e.src.charCodeAt(o-1)===36&&e.src.charCodeAt(o-2)===36&&(d=e.src.slice(s,o-2),l=!0);e.line=l?u+1:u;let f=e.push(`math_block`,`math`,0);return f.block=!0,f.content=(c?`${c}\n`:``)+e.getLines(t+1,u,e.tShift[t],!0)+(d?`${d}\n`:``),f.map=[t,e.line],f.markup=`$$`,!0},c=()=>(e,n,r,i)=>{let a=e.bMarks[n]+e.tShift[n],o=e.eMarks[n];if(a+2>o||e.src.charCodeAt(a)!==92||e.src.charCodeAt(a+1)!==91)return!1;if(i)return!0;let s=e.skipSpacesBack(o,a),c=a+2,l,u=!1;s-c>=2&&e.src.charCodeAt(s-1)===93&&e.src.charCodeAt(s-2)===92?(l=e.src.slice(c,s-2),u=!0):l=e.src.slice(c,o);let d=n,f=``;for(;!u&&(d++,!(d>=r||(c=e.bMarks[d]+e.tShift[d],o=e.eMarks[d],c<o&&e.tShift[d]<e.blkIndent)));)s=e.skipSpacesBack(o,c),s-c>=2&&e.src.charCodeAt(s-1)===93&&e.src.charCodeAt(s-2)===92&&(f=e.src.slice(c,s-2).trimEnd(),u=!0);if(!u)return!1;e.line=d+1;let p=e.push(`math_block`,`math`,0);return p.block=!0,p.content=(l?`${l}\n`:``)+e.getLines(n+1,d,e.tShift[n],!0)+(f?`${f}\n`:``),p.map=[n,e.line],p.markup=t,!0},l={alt:[`paragraph`,`reference`,`blockquote`,`list`]},u=(e,t)=>{if(typeof t?.render!=`function`)throw TypeError(`[@mdit/plugin-tex]: "render" option should be a function`);let{allowInlineWithSpace:n=!1,mathFence:r=!1,delimiters:i=`dollars`,render:u}=t;if(r){let t=e.renderer.rules.fence;e.renderer.rules.fence=(e,n,r,i,a)=>{let o=e[n];return o.info.trim()===`math`?u(o.content,!0,i):t(e,n,r,i,a)}}(i===`dollars`||i===`all`)&&(e.inline.ruler.after(`escape`,`math_inline_dollar`,a(n)),e.block.ruler.after(`blockquote`,`math_block_dollar`,s,l)),(i===`brackets`||i===`all`)&&(e.inline.ruler.before(`escape`,`math_inline_bracket`,o()),e.block.ruler.after(`blockquote`,`math_block_bracket`,c(),l)),e.renderer.rules.math_inline=(e,t,n,r)=>u(e[t].content,!1,r),e.renderer.rules.math_block=(e,t,n,r)=>u(e[t].content,!0,r)};export{u as tex};
//# sourceMappingURL=index.js.map