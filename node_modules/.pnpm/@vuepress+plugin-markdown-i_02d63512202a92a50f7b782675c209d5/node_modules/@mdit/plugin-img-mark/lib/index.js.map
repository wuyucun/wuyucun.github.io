{"version":3,"file":"index.js","names":[],"sources":["../src/plugin.ts"],"sourcesContent":["import type { PluginWithOptions } from \"markdown-it\";\n\nimport type { MarkdownItImgMarkOptions } from \"./options.js\";\n\nconst ID_SUFFIX_REGEX = /#(.*?)$/;\n\nexport const imgMark: PluginWithOptions<MarkdownItImgMarkOptions> = (\n  md,\n  { light = [\"light\"], dark = [\"dark\"] } = {},\n): void => {\n  // oxlint-disable-next-line typescript/no-non-null-assertion\n  const originalImageRender = md.renderer.rules.image!;\n\n  const lightIds = light.map((item) => `#${item}`);\n  const darkIds = dark.map((item) => `#${item}`);\n\n  md.renderer.rules.image = (tokens, index, options, env, self): string => {\n    const token = tokens[index];\n    const src = token.attrGet(\"src\");\n\n    if (src) {\n      if (lightIds.some((item) => src.endsWith(item))) {\n        token.attrSet(\"data-mode\", \"lightmode-only\");\n        token.attrSet(\"src\", src.replace(ID_SUFFIX_REGEX, \"\"));\n      } else if (darkIds.some((item) => src.endsWith(item))) {\n        token.attrSet(\"data-mode\", \"darkmode-only\");\n        token.attrSet(\"src\", src.replace(ID_SUFFIX_REGEX, \"\"));\n      }\n    }\n\n    return originalImageRender(tokens, index, options, env, self);\n  };\n};\n"],"mappings":"AAIA,MAAM,EAAkB,UAEX,GACX,EACA,CAAE,QAAQ,CAAC,QAAQ,CAAE,OAAO,CAAC,OAAO,EAAK,EAAE,GAClC,CAET,IAAM,EAAsB,EAAG,SAAS,MAAM,MAExC,EAAW,EAAM,IAAK,GAAS,IAAI,IAAO,CAC1C,EAAU,EAAK,IAAK,GAAS,IAAI,IAAO,CAE9C,EAAG,SAAS,MAAM,OAAS,EAAQ,EAAO,EAAS,EAAK,IAAiB,CACvE,IAAM,EAAQ,EAAO,GACf,EAAM,EAAM,QAAQ,MAAM,CAYhC,OAVI,IACE,EAAS,KAAM,GAAS,EAAI,SAAS,EAAK,CAAC,EAC7C,EAAM,QAAQ,YAAa,iBAAiB,CAC5C,EAAM,QAAQ,MAAO,EAAI,QAAQ,EAAiB,GAAG,CAAC,EAC7C,EAAQ,KAAM,GAAS,EAAI,SAAS,EAAK,CAAC,GACnD,EAAM,QAAQ,YAAa,gBAAgB,CAC3C,EAAM,QAAQ,MAAO,EAAI,QAAQ,EAAiB,GAAG,CAAC,GAInD,EAAoB,EAAQ,EAAO,EAAS,EAAK,EAAK"}