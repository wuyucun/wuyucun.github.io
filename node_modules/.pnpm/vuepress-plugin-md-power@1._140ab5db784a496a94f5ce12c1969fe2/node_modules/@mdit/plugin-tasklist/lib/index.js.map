{"version":3,"file":"index.js","names":[],"sources":["../src/utils.ts","../src/plugin.ts"],"sourcesContent":["import type Token from \"markdown-it/lib/token.mjs\";\n\nexport const setTokenAttr = (token: Token, name: string, value: string): void => {\n  const index = token.attrIndex(name);\n  const attr: [string, string] = [name, value];\n\n  if (index < 0) token.attrPush(attr);\n\n  // oxlint-disable-next-line typescript/no-non-null-assertion\n  else token.attrs![index] = attr;\n};\n\nexport const getParentTokenIndex = (tokens: Token[], index: number): number => {\n  const targetLevel = tokens[index].level - 1;\n\n  for (let i = index - 1; i >= 0; i--) if (tokens[i].level === targetLevel) return i;\n\n  /* istanbul ignore next -- @preserve */\n  return -1;\n};\n\nexport const isInlineToken = (token: Token): boolean => token.type === \"inline\";\n\nexport const isParagraphToken = (token: Token): boolean => token.type === \"paragraph_open\";\n\nexport const isListItemToken = (token: Token): boolean => token.type === \"list_item_open\";\n","/**\n * Forked from https://github.com/linsir/markdown-it-task-checkbox/blob/master/index.js\n */\n\nimport type { PluginWithOptions } from \"markdown-it\";\nimport type { RuleCore } from \"markdown-it/lib/parser_core.mjs\";\nimport type StateCore from \"markdown-it/lib/rules_core/state_core.mjs\";\nimport type Token from \"markdown-it/lib/token.mjs\";\n\nimport type { MarkdownItTaskListOptions } from \"./options.js\";\nimport type { TaskListEnv } from \"./types.js\";\nimport {\n  getParentTokenIndex,\n  isInlineToken,\n  isListItemToken,\n  isParagraphToken,\n  setTokenAttr,\n} from \"./utils.js\";\n\ninterface TaskListStateCore extends StateCore {\n  env: TaskListEnv;\n}\n\n// The leading whitespace in a list item (token.content) is already trimmed off by markdown-it.\n// The regex below checks for '[ ] ' or '[x] ' or '[X] ' at the start of the string token.content,\n// where the space is either a normal space or a non-breaking space (character 160 = \\u00A0).\nconst startsWithTodoMarkdown = (token: Token): \"checked\" | boolean => {\n  const content = token.content;\n\n  // minimal length is 4: \"[ ] \"\n  if (content.length < 4) return false;\n\n  if (content.charCodeAt(0) !== 91 /* [ */) return false;\n\n  if (content.charCodeAt(2) !== 93 /* ] */) return false;\n\n  const spacer = content.charCodeAt(3);\n\n  if (spacer !== 32 /* space */ && spacer !== 160 /* \\u00A0 */) return false;\n\n  const contentChar = content.charCodeAt(1);\n\n  if (contentChar === 120 /* x */ || contentChar === 88 /* X */) return \"checked\";\n\n  return contentChar === 32 /* space */ || contentChar === 160 /* \\u00A0 */;\n};\n\nexport const tasklist: PluginWithOptions<MarkdownItTaskListOptions> = (\n  md,\n  {\n    disabled = true,\n    label = true,\n    containerClass = \"task-list-container\",\n    itemClass = \"task-list-item\",\n    checkboxClass = \"task-list-item-checkbox\",\n    labelClass = \"task-list-item-label\",\n  } = {},\n) => {\n  const taskListRule: RuleCore = (state: TaskListStateCore) => {\n    const tokens = state.tokens;\n\n    state.env.tasklistId ||= 0;\n\n    for (let index = 2; index < tokens.length; index++) {\n      const token = tokens[index];\n\n      // check if the token is an inline token inside a list item and starts with todo markdown\n      if (\n        !isInlineToken(token) ||\n        !isParagraphToken(tokens[index - 1]) ||\n        !isListItemToken(tokens[index - 2])\n      )\n        continue;\n\n      const todoState = startsWithTodoMarkdown(token);\n\n      if (todoState === false) continue;\n\n      token.children ??= [];\n\n      // remove the checkbox syntax letter\n      token.children[0].content = token.children[0].content.slice(3);\n\n      const id = `task-item-${state.env.tasklistId++}`;\n\n      if (label) {\n        // add label\n        const labelToken = new state.Token(\"label_open\", \"label\", 1);\n\n        labelToken.attrs = [\n          [\"class\", labelClass],\n          [\"for\", id],\n        ];\n\n        token.children.unshift(labelToken);\n        token.children.push(new state.Token(\"label_close\", \"label\", -1));\n      }\n\n      const checkboxToken = new state.Token(\"checkbox_input\", \"input\", 0);\n\n      checkboxToken.attrs = [\n        [\"type\", \"checkbox\"],\n        [\"class\", checkboxClass],\n        [\"id\", id],\n      ];\n\n      // if token.content starts with '[x] ' or '[X] '\n      if (todoState === \"checked\") checkboxToken.attrs.push([\"checked\", \"checked\"]);\n\n      if (disabled) checkboxToken.attrs.push([\"disabled\", \"disabled\"]);\n\n      // checkbox\n      token.children.unshift(checkboxToken);\n\n      setTokenAttr(tokens[index - 2], \"class\", itemClass);\n      setTokenAttr(tokens[getParentTokenIndex(tokens, index - 2)], \"class\", containerClass);\n    }\n\n    return true;\n  };\n\n  md.core.ruler.after(\"inline\", \"task_list\", taskListRule);\n};\n"],"mappings":"AAEA,MAAa,GAAgB,EAAc,EAAc,IAAwB,CAC/E,IAAM,EAAQ,EAAM,UAAU,EAAK,CAC7B,EAAyB,CAAC,EAAM,EAAM,CAExC,EAAQ,EAAG,EAAM,SAAS,EAAK,CAG9B,EAAM,MAAO,GAAS,GAGhB,GAAuB,EAAiB,IAA0B,CAC7E,IAAM,EAAc,EAAO,GAAO,MAAQ,EAE1C,IAAK,IAAI,EAAI,EAAQ,EAAG,GAAK,EAAG,IAAK,GAAI,EAAO,GAAG,QAAU,EAAa,OAAO,EAGjF,MAAO,IAGI,EAAiB,GAA0B,EAAM,OAAS,SAE1D,EAAoB,GAA0B,EAAM,OAAS,iBAE7D,EAAmB,GAA0B,EAAM,OAAS,iBCCnE,EAA0B,GAAsC,CACpE,IAAM,EAAU,EAAM,QAOtB,GAJI,EAAQ,OAAS,GAEjB,EAAQ,WAAW,EAAE,GAAK,IAE1B,EAAQ,WAAW,EAAE,GAAK,GAAY,MAAO,GAEjD,IAAM,EAAS,EAAQ,WAAW,EAAE,CAEpC,GAAI,IAAW,IAAkB,IAAW,IAAkB,MAAO,GAErE,IAAM,EAAc,EAAQ,WAAW,EAAE,CAIzC,OAFI,IAAgB,KAAe,IAAgB,GAAmB,UAE/D,IAAgB,IAAkB,IAAgB,KAG9C,GACX,EACA,CACE,WAAW,GACX,QAAQ,GACR,iBAAiB,sBACjB,YAAY,iBACZ,gBAAgB,0BAChB,aAAa,wBACX,EAAE,GACH,CAgEH,EAAG,KAAK,MAAM,MAAM,SAAU,YA/DE,GAA6B,CAC3D,IAAM,EAAS,EAAM,OAErB,EAAM,IAAI,aAAe,EAEzB,IAAK,IAAI,EAAQ,EAAG,EAAQ,EAAO,OAAQ,IAAS,CAClD,IAAM,EAAQ,EAAO,GAGrB,GACE,CAAC,EAAc,EAAM,EACrB,CAAC,EAAiB,EAAO,EAAQ,GAAG,EACpC,CAAC,EAAgB,EAAO,EAAQ,GAAG,CAEnC,SAEF,IAAM,EAAY,EAAuB,EAAM,CAE/C,GAAI,IAAc,GAAO,SAEzB,EAAM,WAAa,EAAE,CAGrB,EAAM,SAAS,GAAG,QAAU,EAAM,SAAS,GAAG,QAAQ,MAAM,EAAE,CAE9D,IAAM,EAAK,aAAa,EAAM,IAAI,eAElC,GAAI,EAAO,CAET,IAAM,EAAa,IAAI,EAAM,MAAM,aAAc,QAAS,EAAE,CAE5D,EAAW,MAAQ,CACjB,CAAC,QAAS,EAAW,CACrB,CAAC,MAAO,EAAG,CACZ,CAED,EAAM,SAAS,QAAQ,EAAW,CAClC,EAAM,SAAS,KAAK,IAAI,EAAM,MAAM,cAAe,QAAS,GAAG,CAAC,CAGlE,IAAM,EAAgB,IAAI,EAAM,MAAM,iBAAkB,QAAS,EAAE,CAEnE,EAAc,MAAQ,CACpB,CAAC,OAAQ,WAAW,CACpB,CAAC,QAAS,EAAc,CACxB,CAAC,KAAM,EAAG,CACX,CAGG,IAAc,WAAW,EAAc,MAAM,KAAK,CAAC,UAAW,UAAU,CAAC,CAEzE,GAAU,EAAc,MAAM,KAAK,CAAC,WAAY,WAAW,CAAC,CAGhE,EAAM,SAAS,QAAQ,EAAc,CAErC,EAAa,EAAO,EAAQ,GAAI,QAAS,EAAU,CACnD,EAAa,EAAO,EAAoB,EAAQ,EAAQ,EAAE,EAAG,QAAS,EAAe,CAGvF,MAAO,IAG+C"}