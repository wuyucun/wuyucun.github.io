import{Logger as q,entries as F,fromEntries as J}from"@vuepress/helper";import{removeLeadingSlash as k,isFunction as K,removeEndingSlash as Q}from"vuepress/shared";import{path as g,fs as h,colors as c}from"vuepress/utils";import w from"gray-matter";import{millify as E}from"millify";import{estimateTokenCount as M}from"tokenx";import Y from"byte-size";import{remark as Z}from"remark";import{remove as tt}from"unist-util-remove";const y="@vuepress/plugin-llms",b="LLM Documentation",v="This file contains links to all documentation sections.",P=`# {title}

{description}

{alternateLinks}{details}

## Table of Contents

{toc}`,et=t=>new RegExp(`(\\n\\s*\\n)?\\{${t}\\}`,"gi"),S=(t,e,n,a)=>t.replace(et(e),(l,o)=>{const r=n?.length?n:a?.length?a:"";return r?`${o?`

`:""}${r}`:""}),T=(t,e)=>Object.entries(e).reduce((n,[a,l])=>S(n,a,l),t),nt=/^#[^#][\s]*(.+?)#*?$/m,C=t=>{const e=t.match(nt);if(e?.length)return e.pop()?.trim()},A=t=>{const e=g.extname(t);return e===""||t.endsWith("/")?t:t.slice(0,-e.length)},_=(t,e)=>t.startsWith(e)?t:`${e}${k(t)}`,L=(t,{base:e,domain:n,linkExtension:a})=>{const l=_(`${A(t)}${a}`,e);return`${n??""}${l}`},j=(t,e)=>{const{description:n}=t.frontmatter,{autoDesc:a}=t.data,l=L(t.htmlFilePathRelative,e);return`- [${t.title}](${l})${n&&!a?`: ${n.trim()}`:""}
`},s=new q(y),G=t=>Y(new Blob([t]).size).toString(),z=(t,{siteLocale:e})=>{const n=t.find(a=>a.path===a.pathLocale);return n?.frontmatter.heroText||e.title||n?.title||b},O=(t,{siteLocale:e})=>{const n=t.find(l=>l.path===l.pathLocale),a=n?.frontmatter.tagline||e.description||(n?.data.autoDesc?"":n?.frontmatter.description);return a?`> ${a}`:""},R=t=>t.find(e=>e.path===e.pathLocale)?.frontmatter.details||v,U=(t,e)=>{const{allLocales:n,app:a,currentLocale:l}=e;if(!n||l!=="/")return"";const o=F(a.siteData.locales).map(([r,{lang:i}])=>r==="/"?null:i?`- [${i}](${L(`${r}llms.txt`,e)})`:(s.error(`No lang definition found for locale path: ${r}, it is omitted.`),null)).filter(r=>r!==null);return o.length?`

## Alternate Language Versions

${o.join(`
`)}

`:""},H=(t,e)=>t.map(n=>j(n,e)).join(""),I={title:z,description:O,details:R,alternateLinks:U,toc:H},N=async(t,e)=>{s.load("Generating llm friendly docs");const n=t.map(async a=>{const l={url:L(a.htmlFilePathRelative,{...e,linkExtension:".md"})};a.frontmatter.description&&!a.data.autoDesc&&(l.description=a.frontmatter.description);const o=a.htmlFilePathRelative.replace(/\.html$/,".md"),r=e.app.dir.dest(o),i=w.stringify(a.markdown,l);try{await h.mkdir(g.dirname(r),{recursive:!0}),await h.writeFile(r,i,"utf-8"),s.load(`Generated llm friendly docs - ${c.cyan(o)}`)}catch(m){s.error(`Failed to process ${c.cyan(o)}: ${m.message}`)}});await Promise.all(n),s.succeed(`Generated LLM-friendly docs for ${t.length} documentation links`)},W=async(t,e,{llmsTxtTemplate:n,llmsTxtTemplateGetter:a})=>{const{app:l,allLocales:o,currentLocale:r}=e,i=o?g.join(k(r),"llms.txt"):"llms.txt";s.load(`Generating ${i}`);const m=J(F({...I,...a}).map(([p,u])=>[p,K(u)?u(t,e):u])),d=T(n,m);await h.writeFile(l.dir.dest(i),d,"utf-8"),s.succeed(T("Generated {file} (~{tokens} tokens, {size}) with {pageCount} documentation links",{file:c.cyan(i),tokens:c.bold(E(M(d))),size:c.bold(G(d)),pageCount:c.bold(t.length)}))},at=`
---

`,B=async(t,e)=>{const{app:n,allLocales:a,currentLocale:l}=e,o=a?g.join(k(l),"llms-full.txt"):"llms-full.txt";s.load(`Generating ${o}`);const r=t.map(i=>{const m={url:L(i.htmlFilePathRelative,e)};i.frontmatter.description&&!i.data.autoDesc&&(m.description=i.frontmatter.description);const d=C(i.markdown)?i.markdown:`# ${i.title}
${i.markdown}`;return w.stringify(d,m)}).join(at);await h.writeFile(n.dir.dest(o),r,"utf-8"),s.succeed(T("Generated {file} (~{tokens} tokens, {size}) with {pageCount} documentation links",{file:c.cyan(o),tokens:c.bold(E(M(r))),size:c.bold(G(r)),pageCount:c.bold(t.length)}))},ot=()=>t=>(tt(t,{type:"html"}),t),lt=Z().use(ot),rt=(t,{stripHTML:e,filter:n,currentLocale:a})=>{const l=[];for(const o of t.pages){if(o.pathLocale!==a||!o.filePath?.endsWith(".md")||o.frontmatter.llmstxt===!1||!n(o))continue;const{content:r}=w(o.content);r.trim().length&&(e&&(o.markdown=String(lt.processSync(r))),l.push(o))}return l.sort((o,r)=>o.path.localeCompare(r.path)),l},it=(t={})=>e=>(e.env.isDebug&&s.info("Options: ",t),{name:y,onGenerated:async()=>{const{domain:n,llmsTxt:a=!0,llmsFullTxt:l=!0,llmsPageTxt:o=!0,filter:r=()=>!0,stripHTML:i=!0,llmsTxtTemplate:m=P,llmsTxtTemplateGetter:d={},locale:p="/"}=t,u=o?".md":".html",{locales:V,...X}=e.siteData,D=async f=>{const $={app:e,base:e.options.base,domain:n?Q(n):void 0,linkExtension:u,currentLocale:f,siteLocale:{...X,...V[f]},allLocales:p==="all"},x=rt(e,{stripHTML:i,filter:r,currentLocale:f});a&&await W(x,$,{llmsTxtTemplate:m,llmsTxtTemplateGetter:d}),l&&await B(x,$),o&&await N(x,$)};if(p==="all")for(const f in e.siteData.locales)await D(f);else await D(p)}});export{P as DEFAULT_LLMSTXT_TEMPLATE,v as DEFAULT_LLMS_DETAILS,b as DEFAULT_LLMS_TITLE,y as PLUGIN_NAME,U as defaultAlternateLinksGetter,O as defaultDescriptionGetter,R as defaultDetailsGetter,H as defaultTOCGetter,I as defaultTemplateGetter,z as defaultTitleGetter,T as expandTemplate,C as extractTitle,N as generateLLMFriendlyDocs,B as generateLLMsFullTxt,W as generateLLMsTxt,L as generateLink,j as generateTOCLink,G as getSizeOf,it as llmsPlugin,s as logger,S as replaceTemplateVariable,A as stripExt,_ as withBase};
//# sourceMappingURL=index.js.map
